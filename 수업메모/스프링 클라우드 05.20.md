#### 아키텍쳐

---

- gateway --다른서비스, 클라이언트와 주고받기 위함  zuul(routing 역할도 겸함)

- service mesh --service discovery ,config , git 
- instance간 통신 -- restplatform .feign
- telemetry -- monitoring
  - zipkin -trace 확인 (모니터링 서비스)



##### zipkin

trace 마이크로서비스에서 작업이 요청되어 완료될때 까지( 전체흐름)

span  어떤마이크로가 호출했는지(개별적인 id 값)



depentdency 추가

```yaml
zipkin:
  base-url: http://localhost:9411
  sender:
    type: web
sleuth:
  sampler:
    probability: 1
```

 localhost:9411 에서 확인



eurka security 

depentdency 추가 

application.yml  name , password 

---

discovery service 

spring.security/user.name , spring.security.user.password



depentdency 추가 (cloud -config)

discovery 의 bootstrap.yml

```yaml
spring:
  cloud:
    config:
      uri: http://localhost:8012
      name: DiscoveryService
```

DiscoveryService.yml

```yaml
spring:
    security:
        user:
            name: test
            password: '{cipher}AQAWK+u8qEvTQd4+4yiBTmB8Tyv0cyFKdSe5mX3y+76OjgeZ6R7DofpGo1X33kVMESb9C51EcoUjCxK/FgIFlElk/yjPKx+vIyjnHL0bAZWVtDh7mvsLN+2rUUDpAz6uXUQvNJQ5kyS7ksOwi6xxgR7BF6FkHrqNnR0u4akuLH2VXjh+b12OuXD6tPtwNYhnhZzLSjLJj94WdNMOjX0B2DJjFI7JfNDVfmyHqt8Ze6TSdWzAtdM+AzG5NmJbpFPx0n9D2myWKO82rH/yKisn0DI88LkbgJHRhFy9L/iI0s0yNGEwAfXoMUjiRypI3PVnsGXy4S8I3Xn/A4MR9Ax/LXSvDR/XydyNu44FoDY0jqFQKJUGIuCqR6sj2gRY8W7o0ME='
```



---

docker 배포

 rabbitmq , config 

-> 유레카 api gateway 

-> albums -> mysql -> userapi



sudo yum update 

sudo yum install 



mvn clean 

mvn package 

docker build --tag=suhaw0325/config-server --force-rm=true .



dockerfile 

```dockerfile
FROM openjdk:8-jdk-alpine
VOLUME /tmp
COPY apiEncryptionKey.jks apiEncryptionKey.jks
COPY UnlimitedJCEPolicyJDK8/* /usr/lib/jvm/java-1.8-openjdk/jre/lib/security/
COPY target/myapp--config-server-0.1.jar ConfigServer.jar
ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "ConfigServer.jar"]

```



docker push suhaw0325/config-server





docker inspect rabbitmq